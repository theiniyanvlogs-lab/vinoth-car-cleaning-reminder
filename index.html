<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vinoth Car Cleaning â€“ Pending Payments</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
h2{text-align:center}
.form,.actions{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ccc}
button{padding:12px;width:100%;margin-top:10px;border:none;border-radius:6px;font-size:15px;cursor:pointer}
.add{background:#007bff;color:#fff}
.pdfBtn{background:#198754;color:#fff}
</style>
</head>
<body>

<h2>ðŸš— Vinoth Car Cleaning â€“ Pending Payments</h2>

<div class="form">
<h3>Add Customer</h3>

<input id="ownerName" placeholder="Owner Name (optional)">
<input id="flatNo" placeholder="Flat Number (optional)">
<input id="carNo" placeholder="Car Number (optional)">
<input id="mobile" placeholder="Mobile Number">

<select id="month">
  <option value="">Select Month</option>
  <option>January</option><option>February</option><option>March</option>
  <option>April</option><option>May</option><option>June</option>
  <option>July</option><option>August</option><option>September</option>
  <option>October</option><option>November</option><option>December</option>
</select>

<select id="year">
  <option value="">Select Year</option>
  <option>2024</option><option>2025</option><option>2026</option>
</select>

<input id="amount" type="number" value="600">

<select id="status">
  <option value="pending">Pending</option>
  <option value="paid">Paid</option>
</select>

<button class="add" onclick="savePayment()">Save</button>
</div>

<div class="actions">
  <button class="pdfBtn" onclick="exportPendingPDF()">Export Pending (PDF)</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ðŸ”¥ FIREBASE INIT */
firebase.initializeApp({
  apiKey:"AIzaSyCWbIwSjYSHrMYvvKK8HByqcDy6wUj7pu8",
  authDomain:"vinoth-car-cleaning-reminder.firebaseapp.com",
  projectId:"vinoth-car-cleaning-reminder"
});
const db = firebase.firestore();
const ref = db.collection("carPayments");

/* SAVE */
function savePayment(){
  const data = {
    name: ownerName.value.trim(),
    flat: flatNo.value.trim(),
    car: carNo.value.trim(),
    mobile: mobile.value.replace(/\s+/g,""),
    month: month.value + " " + year.value,
    amount: Number(amount.value),
    status: status.value.toLowerCase() // ðŸ”‘ FORCE LOWERCASE
  };

  if(data.mobile.length < 10 || !month.value || !year.value || (!data.flat && !data.car)){
    alert("Enter Mobile + Flat or Car");
    return;
  }

  ref.add(data);
  resetForm();
}

function resetForm(){
  ownerName.value=flatNo.value=carNo.value=mobile.value="";
  month.value=year.value="";
  amount.value=600;
  status.value="pending";
}

/* ðŸ“„ EXPORT PDF â€“ DIRECT FROM FIRESTORE */
async function exportPendingPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const snap = await ref.where("status","==","pending").get();

  doc.setFontSize(14);
  doc.text("Vinoth Car Cleaning â€“ Pending Payments", 10, 10);

  if(snap.empty){
    doc.setFontSize(12);
    doc.text("No pending records available.", 10, 25);
  } else {
    let y = 25;
    let i = 1;
    snap.forEach(docu=>{
      const p = docu.data();
      doc.setFontSize(10);
      doc.text(
        `${i}. ${p.name || "Owner"} | Flat: ${p.flat||"-"} | Car: ${p.car||"-"} | Mobile: ${p.mobile} | ${p.month} | â‚¹${p.amount}`,
        10,
        y
      );
      y += 8;
      i++;
      if(y > 280){ doc.addPage(); y = 10; }
    });
  }

  doc.save("Pending_Payments.pdf");
}
</script>

</body>
</html>
