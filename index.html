<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vinoth Car Cleaning â€“ Payments</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
h2{text-align:center}
.form,.list,.summary,.actions{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ccc}
button{padding:10px;width:100%;margin-top:8px;border:none;border-radius:6px;font-size:14px;cursor:pointer}
.add{background:#007bff;color:#fff}
.pendingBtn{background:#ff9800;color:#fff}
.showAll{background:#6c757d;color:#fff}
.card{border-bottom:1px solid #ddd;padding:10px 0}
small{color:#555}
#lockScreen{max-width:380px;margin:80px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1);text-align:center}
</style>
</head>
<body>

<!-- ğŸ”’ PASSWORD -->
<div id="lockScreen">
  <h3>ğŸ”’ Enter Password</h3>
  <input type="password" id="passwordInput">
  <button id="unlockBtn" class="add" type="button">Unlock</button>
  <p id="errorText" style="color:red"></p>
</div>

<!-- ğŸ”“ APP -->
<div id="appContent" style="display:none">

<h2>ğŸš— Vinoth Car Cleaning â€“ Payments</h2>

<div class="summary">
<b>Total Pending Amount:</b> â‚¹<span id="totalPending">0</span>
</div>

<div class="form">
<h3>Add Customer</h3>

<input id="ownerName" placeholder="Owner Name (optional)">
<input id="flatNo" placeholder="Flat Number (optional)">
<input id="carNo" placeholder="Car Number (optional)">
<input id="mobile" placeholder="Mobile Number">

<select id="month">
  <option value="">Select Month</option>
  <option>January</option><option>February</option><option>March</option>
  <option>April</option><option>May</option><option>June</option>
  <option>July</option><option>August</option><option>September</option>
  <option>October</option><option>November</option><option>December</option>
</select>

<select id="year">
  <option value="">Select Year</option>
  <option>2024</option><option>2025</option><option>2026</option>
</select>

<input id="amount" type="number" value="600">

<select id="status">
  <option value="pending">Pending</option>
  <option value="paid">Paid</option>
</select>

<button id="saveBtn" class="add" type="button">Save</button>
</div>

<div class="actions">
  <button id="pendingBtn" class="pendingBtn" type="button">Show Pending</button>
  <button id="allBtn" class="showAll" type="button">Show All</button>
</div>

<div class="list">
<h3>Payments List</h3>
<div id="paymentList"></div>
</div>

</div>

<!-- ğŸ”¥ FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ğŸ” PASSWORD */
const ALLOWED_PASSWORDS=["vinoth600","clean@247"];
const PASSWORD_VERSION="v11";

const lockScreen=document.getElementById("lockScreen");
const appContent=document.getElementById("appContent");

if(localStorage.getItem("appUnlocked")===PASSWORD_VERSION){
  lockScreen.style.display="none";
  appContent.style.display="block";
}

document.getElementById("unlockBtn").addEventListener("click",()=>{
  if(ALLOWED_PASSWORDS.includes(passwordInput.value)){
    localStorage.setItem("appUnlocked",PASSWORD_VERSION);
    lockScreen.style.display="none";
    appContent.style.display="block";
  } else {
    errorText.innerText="Wrong password";
  }
});

/* ğŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyCWbIwSjYSHrMYvvKK8HByqcDy6wUj7pu8",
  authDomain:"vinoth-car-cleaning-reminder.firebaseapp.com",
  projectId:"vinoth-car-cleaning-reminder"
});
const db=firebase.firestore();
const ref=db.collection("carPayments");

/* STATE */
let payments=[];
let viewMode="all";

/* BUTTON EVENTS */
document.getElementById("pendingBtn").addEventListener("click",()=>{
  viewMode="pending";
  render();
});
document.getElementById("allBtn").addEventListener("click",()=>{
  viewMode="all";
  render();
});
document.getElementById("saveBtn").addEventListener("click",addOrUpdate);

/* ADD */
async function addOrUpdate(){
  const data={
    name:ownerName.value.trim(),
    flat:flatNo.value.trim(),
    car:carNo.value.trim(),
    mobile:mobile.value.replace(/\s+/g,""),
    month:month.value+" "+year.value,
    amount:Number(amount.value),
    status:status.value.toLowerCase()
  };

  if(data.mobile.length<10 || !month.value || !year.value || (!data.flat && !data.car)){
    alert("Please enter Mobile Number and Flat or Car");
    return;
  }

  resetForm();
  await ref.add(data);
}

/* RESET */
function resetForm(){
  ownerName.value=flatNo.value=carNo.value=mobile.value="";
  month.value=year.value="";
  amount.value=600;
  status.value="pending";
}

/* FIREBASE LISTENER */
ref.onSnapshot(snap=>{
  payments=[];
  snap.forEach(d=>payments.push({...d.data(),id:d.id}));
  render();
});

/* RENDER */
function render(){
  paymentList.innerHTML="";
  let total=0;

  payments.forEach(p=>{
    const s=(p.status||"").toLowerCase();
    if(viewMode==="pending" && s!=="pending") return;
    if(s==="pending") total+=p.amount;

    paymentList.innerHTML+=`
      <div class="card">
        <b>${p.name||"Owner"}</b>
        ${p.flat?`(Flat ${p.flat})`:""}<br>
        ${p.car?`ğŸš— ${p.car}<br>`:""}
        ğŸ“ ${p.mobile}<br>
        ğŸ—“ï¸ ${p.month}<br>
        ğŸ’° â‚¹${p.amount}
        <small> â€¢ ${s.toUpperCase()}</small>
      </div>`;
  });

  totalPending.innerText=total;
}
</script>

</body>
</html>
