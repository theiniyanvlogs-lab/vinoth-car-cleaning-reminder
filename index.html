<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vinoth Car Cleaning ‚Äì Payments</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
h2{text-align:center}
.form,.list,.actions{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ccc}
button{padding:10px;width:100%;margin-top:8px;border:none;border-radius:6px;font-size:14px;cursor:pointer}
.add{background:#007bff;color:#fff}
.pendingBtn{background:#ff9800;color:#fff}
.showAll{background:#6c757d;color:#fff}
.pdfBtn{background:#198754;color:#fff}
.card{border-bottom:1px solid #ddd;padding:10px 0}
small{color:#555}
</style>
</head>
<body>

<h2>üöó Vinoth Car Cleaning ‚Äì Payments</h2>

<div class="form">
<h3>Add Customer</h3>

<input id="ownerName" placeholder="Owner Name (optional)">
<input id="flatNo" placeholder="Flat Number (optional)">
<input id="carNo" placeholder="Car Number (optional)">
<input id="mobile" placeholder="Mobile Number">

<select id="month">
  <option value="">Select Month</option>
  <option>January</option><option>February</option><option>March</option>
  <option>April</option><option>May</option><option>June</option>
  <option>July</option><option>August</option><option>September</option>
  <option>October</option><option>November</option><option>December</option>
</select>

<select id="year">
  <option value="">Select Year</option>
  <option>2024</option><option>2025</option><option>2026</option>
</select>

<input id="amount" type="number" value="600">

<select id="status">
  <option value="pending">Pending</option>
  <option value="paid">Paid</option>
</select>

<button type="button" class="add" onclick="addPayment()">Save</button>
</div>

<div class="actions">
  <button type="button" class="pendingBtn" onclick="showPending()">Show Pending</button>
  <button type="button" class="showAll" onclick="showAll()">Show All</button>
  <button type="button" class="pdfBtn" onclick="downloadPendingPDF()">Pending (PDF)</button>
</div>

<div class="list">
<h3>Payments List</h3>
<div id="paymentList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* üî• FIREBASE CONFIG */
firebase.initializeApp({
  apiKey:"AIzaSyCWbIwSjYSHrMYvvKK8HByqcDy6wUj7pu8",
  authDomain:"vinoth-car-cleaning-reminder.firebaseapp.com",
  projectId:"vinoth-car-cleaning-reminder"
});

const db = firebase.firestore();
const ref = db.collection("carPayments");

let payments = [];
let visiblePayments = [];

/* ADD PAYMENT */
function addPayment(){
  const data = {
    name: ownerName.value.trim(),
    flat: flatNo.value.trim(),
    car: carNo.value.trim(),
    mobile: mobile.value.replace(/\s+/g,""),
    month: month.value + " " + year.value,
    amount: Number(amount.value),
    status: status.value.toLowerCase()
  };

  if(data.mobile.length < 10 || !month.value || !year.value || (!data.flat && !data.car)){
    alert("Enter Mobile + Flat or Car");
    return;
  }

  ref.add(data);
  resetForm();
}

/* RESET */
function resetForm(){
  ownerName.value=flatNo.value=carNo.value=mobile.value="";
  month.value=year.value="";
  amount.value=600;
  status.value="pending";
}

/* LOAD FROM FIREBASE */
ref.onSnapshot(snapshot=>{
  payments=[];
  snapshot.forEach(doc=>payments.push(doc.data()));
  visiblePayments=[...payments];
  render();
});

/* FILTERS */
function showPending(){
  visiblePayments = payments.filter(p => (p.status||"").toLowerCase()==="pending");
  render();
}

function showAll(){
  visiblePayments = [...payments];
  render();
}

/* RENDER LIST */
function render(){
  paymentList.innerHTML="";
  visiblePayments.forEach(p=>{
    paymentList.innerHTML += `
      <div class="card">
        <b>${p.name || "Owner"}</b>
        ${p.flat ? `(Flat ${p.flat})` : ""}<br>
        ${p.car ? `üöó ${p.car}<br>` : ""}
        üìû ${p.mobile}<br>
        üóìÔ∏è ${p.month}<br>
        üí∞ ‚Çπ${p.amount}
        <small> ‚Ä¢ ${p.status.toUpperCase()}</small>
      </div>
    `;
  });
}

/* üìÑ PDF GENERATION */
function downloadPendingPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  let y = 10;
  doc.setFontSize(14);
  doc.text("Vinoth Car Cleaning ‚Äì Pending Payments", 10, y);
  y += 10;

  const pending = payments.filter(p => (p.status||"").toLowerCase()==="pending");

  if(pending.length === 0){
    doc.text("No pending records.", 10, y);
  } else {
    pending.forEach((p,i)=>{
      doc.setFontSize(10);
      doc.text(
        `${i+1}. ${p.name || "Owner"} | Flat: ${p.flat || "-"} | Car: ${p.car || "-"} | Mobile: ${p.mobile} | ${p.month} | ‚Çπ${p.amount}`,
        10,
        y
      );
      y += 8;
      if(y > 280){ doc.addPage(); y = 10; }
    });
  }

  doc.save("Pending_Payments.pdf");
}
</script>

</body>
</html>
